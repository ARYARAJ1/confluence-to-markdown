<!DOCTYPE html>
<html>
    <head>
        <title>SDI : Infrastructure as Code Platform for Azure</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">SDI</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            SDI : Infrastructure as Code Platform for Azure
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Jason Dang</span>, last modified by <span class='editor'> Jacob Abela</span> on Dec 02, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Add your comments directly to the page. Include links to any relevant research, data, or feedback.</p></div></div><p>

</p><div class='plugin-tabmeta-details'><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 180.0px;"/><col style="width: 636.0px;"/></colgroup><tbody><tr><th class="confluenceTh"><p>Status</p></th><td class="confluenceTd"><p><span class="status-macro aui-lozenge aui-lozenge-success">OUTCOME DECIDED</span></p></td></tr><tr><th class="confluenceTh"><p>Impact</p></th><td class="confluenceTd"><p><span class="status-macro aui-lozenge aui-lozenge-current">MEDIUM</span> </p></td></tr><tr><th class="confluenceTh"><p>Driver</p></th><td class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="5dc205b07dcf390c61845cd1" data-account-id="5dc205b07dcf390c61845cd1" href="https://vmia.atlassian.net/wiki/people/5dc205b07dcf390c61845cd1?ref=confluence" target="_blank" data-base-url="https://vmia.atlassian.net/wiki">Jason Dang (Deactivated)</a>Â </p></td></tr><tr><th class="confluenceTh"><p>Approver</p></th><td class="confluenceTd"><p> <a class="confluence-userlink user-mention" data-username="557058:95d974ad-d96e-49bb-8bce-92252d14c385" data-account-id="557058:95d974ad-d96e-49bb-8bce-92252d14c385" href="https://vmia.atlassian.net/wiki/people/557058:95d974ad-d96e-49bb-8bce-92252d14c385?ref=confluence" target="_blank" data-linked-resource-id="294914" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://vmia.atlassian.net/wiki">Hendry Susilo</a> </p></td></tr><tr><th class="confluenceTh"><p>Contributors</p></th><td class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="5ecf250a4824b20c182c6999" data-account-id="5ecf250a4824b20c182c6999" href="https://vmia.atlassian.net/wiki/people/5ecf250a4824b20c182c6999?ref=confluence" target="_blank" data-linked-resource-id="6979597" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://vmia.atlassian.net/wiki">h.lindsaysmith@vmia.vic.gov.au Lindsay-Smith</a> <a class="confluence-userlink user-mention" data-username="5ecf24fba04d9c0c2207b25a" data-account-id="5ecf24fba04d9c0c2207b25a" href="https://vmia.atlassian.net/wiki/people/5ecf24fba04d9c0c2207b25a?ref=confluence" target="_blank" data-linked-resource-id="9633798" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://vmia.atlassian.net/wiki">p.lim@vmia.vic.gov.au Lim</a> </p></td></tr><tr><th class="confluenceTh"><p>Informed</p></th><td class="confluenceTd"><p><a class="confluence-userlink user-mention" data-username="5e460f2c2a59dc0c8fe4b3d8" data-account-id="5e460f2c2a59dc0c8fe4b3d8" href="https://vmia.atlassian.net/wiki/people/5e460f2c2a59dc0c8fe4b3d8?ref=confluence" target="_blank" data-linked-resource-id="9633824" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://vmia.atlassian.net/wiki">Mentes Keles</a><a class="confluence-userlink user-mention" data-username="5dbb971f4ff1890d3103875a" data-account-id="5dbb971f4ff1890d3103875a" href="https://vmia.atlassian.net/wiki/people/5dbb971f4ff1890d3103875a?ref=confluence" target="_blank" data-linked-resource-id="6979594" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://vmia.atlassian.net/wiki">Lasath Kahingala</a> <a class="confluence-userlink user-mention" data-username="5e460f2a393ea90c94b37233" data-account-id="5e460f2a393ea90c94b37233" href="https://vmia.atlassian.net/wiki/people/5e460f2a393ea90c94b37233?ref=confluence" target="_blank" data-linked-resource-id="9633823" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://vmia.atlassian.net/wiki">Michael Thien</a> </p></td></tr><tr><th class="confluenceTh"><p>Due date</p></th><td class="confluenceTd"><p>26/06/2020</p></td></tr><tr><th class="confluenceTh"><p>Outcome</p></th><td class="confluenceTd"><p>VMIA has agreed for Pulumi to be the Infrastructure as Code platform for the strategic data platform pending the outcome of commercial negotiations between Pulumi and VMIA. 3 Licenses will be provisioned.</p></td></tr></tbody></table></div></div><h2 id="InfrastructureasCodePlatformforAzure-Background">Background</h2><p>Infrastructure as Code is a process of managing and provisioning cloud resources. For Azure cloud development the native choice for infrastructure as code is Azure Resource Manager (ARM) Templates. There are however alternative platforms such as pulumi that can be utilised that can accelerate the development of and improve the efficiency of managing Infrastructure as Code. </p><h2 id="InfrastructureasCodePlatformforAzure-Relevantdata">Relevant data</h2><p>Infrastructure as Code is a modern approach for automating the provisioning and deployment of cloud resources instead of the traditional interactive configuration approach known as click-ops. By defining what resources are required to be deployed through configuration scripts, you achieve:</p><ul><li><p>Consistency</p></li><li><p>Reliablilty</p></li><li><p>Reusability</p></li><li><p>Scalability</p></li><li><p>Rapid Deployment</p></li></ul><p>To achieve this in the Azure platform, two potential options are being considered; Azure Resource Manager (ARM) Templates and Pulumi. </p><p><strong>Azure Resource Manager (ARM)</strong></p><p>An ARM template is a JSON file that defines the configuration and deployment of Azure Cloud Resources. Once created, the ARM template can then be uploaded to Azure Resource Manager to deploy all the declared resources. The use of ARM does not incur any additional costs. ARM template reference documentation can be found here for all applicable services: <a href="https://docs.microsoft.com/en-us/azure/templates/" class="external-link" rel="nofollow">https://docs.microsoft.com/en-us/azure/templates/</a></p><p>Below is an example code snippet of an ARM template to deploy a virtual machine. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
    &quot;$schema&quot;: &quot;https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&quot;,
    &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,
    &quot;parameters&quot;: {
        &quot;adminUsername&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;ashuser&quot;,
            &quot;metadata&quot;: {
                &quot;description&quot;: &quot;User name for the Virtual Machine.&quot;
            }
        },
        &quot;adminPassword&quot;: {
            &quot;type&quot;: &quot;securestring&quot;,
            &quot;defaultValue&quot;: &quot;Ashpassword123&quot;,
            &quot;metadata&quot;: {
                &quot;description&quot;: &quot;Password for the Virtual Machine.&quot;
            }
        },
        &quot;osDiskSize&quot;: {
            &quot;type&quot;: &quot;int&quot;,
            &quot;defaultValue&quot;: 1024
        }
    },
    &quot;variables&quot;: {
        &quot;location&quot;: &quot;[resourceGroup().location]&quot;,
        &quot;addressPrefix&quot;: &quot;10.0.0.0/16&quot;,
        &quot;subnetName&quot;: &quot;Subnet&quot;,
        &quot;subnetPrefix&quot;: &quot;10.0.0.0/24&quot;,
        &quot;storageAccountType&quot;: &quot;Standard_LRS&quot;,
        &quot;publicIPAddressType&quot;: &quot;Dynamic&quot;,
        &quot;publicIPAddressName&quot;: &quot;[concat(&#39;my-&#39;,variables(&#39;uniqString&#39;),&#39;-pip&#39;)]&quot;,
        &quot;nsgName&quot;: &quot;[concat(&#39;my-&#39;,variables(&#39;uniqString&#39;),&#39;-nsg&#39;)]&quot;,
        &quot;nicName&quot;: &quot;[concat(&#39;my-&#39;,variables(&#39;uniqString&#39;),&#39;-nic&#39;)]&quot;,
        &quot;vmName&quot;: &quot;[concat(&#39;my-&#39;,variables(&#39;uniqString&#39;),&#39;-vm&#39;)]&quot;,
        &quot;vmSize&quot;: &quot;Standard_DS1_v2&quot;,
        &quot;virtualNetworkName&quot;: &quot;[concat(&#39;my-&#39;,variables(&#39;uniqString&#39;),&#39;-vnet&#39;)]&quot;,
        &quot;uniqString&quot;: &quot;[toLower(substring(uniqueString(resourceGroup().id), 0,5))]&quot;,
        &quot;vnetID&quot;: &quot;[resourceId(&#39;Microsoft.Network/virtualNetworks&#39;,variables(&#39;virtualNetworkName&#39;))]&quot;,
        &quot;subnetRef&quot;: &quot;[concat(variables(&#39;vnetID&#39;),&#39;/subnets/&#39;,variables(&#39;subnetName&#39;))]&quot;,
        &quot;windowsImage&quot;: {
            &quot;publisher&quot;: &quot;MicrosoftWindowsServer&quot;,
            &quot;offer&quot;: &quot;WindowsServer&quot;,
            &quot;sku&quot;: &quot;2012-R2-Datacenter&quot;,
            &quot;version&quot;: &quot;latest&quot;
        }
    },
    &quot;resources&quot;: [
        {
            &quot;apiVersion&quot;: &quot;2017-04-01&quot;,
            &quot;type&quot;: &quot;Microsoft.Network/virtualNetworks&quot;,
            &quot;name&quot;: &quot;[variables(&#39;virtualNetworkName&#39;)]&quot;,
            &quot;location&quot;: &quot;[variables(&#39;location&#39;)]&quot;,
            &quot;properties&quot;: {
                &quot;addressSpace&quot;: {
                    &quot;addressPrefixes&quot;: [
                        &quot;[variables(&#39;addressPrefix&#39;)]&quot;
                    ]
                },
                &quot;subnets&quot;: [
                    {
                        &quot;name&quot;: &quot;[variables(&#39;subnetName&#39;)]&quot;,
                        &quot;properties&quot;: {
                            &quot;addressPrefix&quot;: &quot;[variables(&#39;subnetPrefix&#39;)]&quot;
                        }
                    }
                ]
            }
        }
    ]
}</pre>
</div></div><p /><p><strong>Pulumi</strong></p><p>Pulumi is an open-source infrastructure as code platform which allows developers to define the configuration and deployment of Azure Resources using their own preference of programming language. It includes a CLI, runtime, libraries and a hosted service which allows for a robust way of managing and provisioning cloud infrastructure. The supported programming languages for Pulumi are Typescript, Javascript, Python, Go and C#. </p><p>The following diagram illustrates on a high level how Pulumi works to deploy infrastructure to the cloud:</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/8978442/11599875.png" data-image-src="attachments/8978442/11599875.png" data-height="1186" data-width="1686" data-unresolved-comment-count="0" data-linked-resource-id="11599875" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200611-020835.png" data-base-url="https://vmia.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="8978442" data-linked-resource-container-version="21" data-media-id="78467b32-7dff-41f5-b183-62a25a9e5304" data-media-type="file"></span><p>Pulumi also comes with a portal that provides end to end visibility of infrastructure changes and deployments.  </p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/8978442/11468805.png" data-image-src="attachments/8978442/11468805.png" data-height="298" data-width="386" data-unresolved-comment-count="0" data-linked-resource-id="11468805" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20200611-021034.png" data-base-url="https://vmia.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="8978442" data-linked-resource-container-version="21" data-media-id="7ee00f22-5d6b-42ae-9848-5da9af306f29" data-media-type="file"></span><p>Below is a Python example of a Pulumi project:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: py; gutter: false; theme: Confluence" data-theme="Confluence">import pulumi
from pulumi_azure import core, storage

# Create an Azure Resource Group
resource_group = core.ResourceGroup(&quot;resource_group&quot;)

# Create an Azure resource (Storage Account)
account = storage.Account(&quot;storage&quot;,
    resource_group_name=resource_group.name,
    account_tier=&#39;Standard&#39;,
    account_replication_type=&#39;LRS&#39;)

# Export the connection string for the storage account
pulumi.export(&#39;connection_string&#39;, account.primary_connection_string)</pre>
</div></div><p>In terms of cost, there are 3 different price and licensing models for Pulumi:</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 141.0px;"/><col style="width: 285.0px;"/><col style="width: 212.0px;"/><col style="width: 212.0px;"/></colgroup><tbody><tr><th data-highlight-colour="#b3bac5" class="confluenceTh"><p><strong>Name of Subscription</strong></p></th><th class="confluenceTh"><p><strong>Team Starter</strong></p></th><th class="confluenceTh"><p><strong>Team Pro</strong></p></th><th class="confluenceTh"><p><strong>Enterprise</strong></p></th></tr><tr><td data-highlight-colour="#b3bac5" class="confluenceTd"><p><strong>Price (USD)</strong></p></td><td class="confluenceTd"><p>$50-$60/month</p></td><td class="confluenceTd"><p>$75-$90/user</p></td><td class="confluenceTd"><p>Custom</p></td></tr><tr><td data-highlight-colour="#b3bac5" class="confluenceTd"><p><strong>Description</strong></p></td><td class="confluenceTd"><ul><li><p><strong>3</strong>Â team members</p></li><li><p>Any cloud and language</p></li><li><p>State management</p></li><li><p>Unlimited deployments</p></li><li><p>Secrets management</p></li><li><p>CI/CD integrations</p></li><li><p>1 organization</p></li><li><p>Up to 20 project stacks</p></li><li><p>Unlimited deployment history</p></li><li><p>Team activity dashboard</p></li></ul></td><td class="confluenceTd"><ul><li><p>Up toÂ <strong>25</strong>Â team members</p></li><li><p>Everything in Team Starter</p></li><li><p>Teams and roles</p></li><li><p>Unlimited project stacks</p></li><li><p>APIs and webhooks</p></li><li><p>12Ã5 support available</p></li></ul></td><td class="confluenceTd"><ul><li><p><strong>Unlimited</strong>Â team members</p></li><li><p>Everything in Team Pro</p></li><li><p>SAML/SSO</p></li><li><p>Organization policies</p></li><li><p>Self-host available</p></li><li><p>24Ã7 support available</p></li></ul></td></tr></tbody></table></div><p>More information about pricing can be found here(<a href="https://www.pulumi.com/pricing/" class="external-link" rel="nofollow">https://www.pulumi.com/pricing/</a>)</p><h2 id="InfrastructureasCodePlatformforAzure-Optionsconsidered">Options considered</h2><div class="table-wrap"><table data-layout="default" class="confluenceTable"><colgroup><col style="width: 187.0px;"/><col style="width: 323.0px;"/><col style="width: 340.0px;"/></colgroup><tbody><tr><th class="confluenceTh"><p /></th><th class="confluenceTh"><p>Option 1: ARM Templates</p></th><th class="confluenceTh"><p>Option 2: Pulumi</p></th></tr><tr><th class="confluenceTh"><p>Description</p></th><td class="confluenceTd"><p>An ARM template is a JSON file that defines the configuration and deployment of Azure Cloud Resources. Once created, the ARM template can then be uploaded to Azure Resource Manager to deploy all the declared resources. </p></td><td class="confluenceTd"><p>Pulumi is an open-source infrastructure as code platform which allows developers to define the configuration and deployment of Azure Resources using their own preference of programming language. It includes a CLI, runtime, libraries and a hosted service which allows for a robust way of managing and provisioning cloud infrastructure. The supported programming languages for Pulumi are Typescript, Javascript, Python, Go and C#. </p></td></tr><tr><th class="confluenceTh"><p>Pros and cons</p></th><td class="confluenceTd"><p><img class="emoticon emoticon-plus" data-emoji-id="atlassian-plus" data-emoji-shortname=":plus:" data-emoji-fallback=":plus:" src="images/icons/emoticons/add.png" width="16" height="16" data-emoticon-name="plus" alt="(plus)"/> </p><ul><li><p>No additional cost incurred</p></li><li><p>Azure Portal Support is available as it is a native Azure IaC tool</p></li><li><p>More community support available for ARM (i.e. Stack Overflow popularity)</p></li></ul><p><img class="emoticon emoticon-minus" data-emoji-id="atlassian-minus" data-emoji-shortname=":minus:" data-emoji-fallback=":minus:" src="images/icons/emoticons/forbidden.png" width="16" height="16" data-emoticon-name="minus" alt="(minus)"/></p><ul><li><p>JSON Configuration language is not as readable and easy to learn as familiar programming languages such as Python</p></li><li><p>Highly complex to maintain and develop ARM templates when more Azure resources are deployed. </p><ul><li><p>Size of template files can increase exponentially.</p></li></ul></li><li><p>Only the syntax of ARM templates can be validated. To validate the resources, the template has to be deployed. </p></li><li><p>Tear down of nested resources can be manual</p></li><li><p>A resource group needs to be created first prior to ARM deployment</p></li></ul></td><td class="confluenceTd"><p><img class="emoticon emoticon-plus" data-emoji-id="atlassian-plus" data-emoji-shortname=":plus:" data-emoji-fallback=":plus:" src="images/icons/emoticons/add.png" width="16" height="16" data-emoticon-name="plus" alt="(plus)"/></p><ul><li><p>Leverages familiar programming languages so application developers can easily deploy their own infrastructure resources so less need for mundane 'infrastructure tasksâ</p></li><li><p>Pulumi offers Policy as code (CrossGuard) to enforce compliance on cloud resources before deployment</p></li><li><p>Can integrate with a wide range of CI/CD applications such as Bitbucket and Azure DevOps</p></li><li><p>Open source and community driven with an active slack channel for discussions</p></li><li><p>Pulumi can deploy ARM templates if necessary</p></li><li><p>Environments can easily be torn down</p></li><li><p>Ability to leverage testing frameworks of programming languages</p></li><li><p>Central portal provides a single management plan across multiple subscriptions</p></li></ul><p><img class="emoticon emoticon-minus" data-emoji-id="atlassian-minus" data-emoji-shortname=":minus:" data-emoji-fallback=":minus:" src="images/icons/emoticons/forbidden.png" width="16" height="16" data-emoticon-name="minus" alt="(minus)"/></p><ul><li><p>Product roadmap for Pulumi might be highly dependent on Terraform</p></li><li><p>Most Pulumi customers are US/EU based currently.</p></li><li><p>May lag the ability to support newly release Azure features</p></li></ul></td></tr><tr><th class="confluenceTh"><p>Estimated cost</p></th><td class="confluenceTd"><p><span class="status-macro aui-lozenge aui-lozenge-success">LOW</span></p></td><td class="confluenceTd"><p><span class="status-macro aui-lozenge aui-lozenge-current">MEDIUM</span></p></td></tr></tbody></table></div><h2 id="InfrastructureasCodePlatformforAzure-Recommendation">Recommendation</h2><p>The recommended approach would be to use Pulumi as the Infrastructure as Code Platform for the strategic data project as it will accelerate the development and deployment of Azure resources for VMIA and reduce the operational overhead of the azure platform. While there are license costs incurred for Pulumi, the benefits that it offers including support for familiar coding languages and end to end visibility monitoring and auditing of Azure infrastructure can be argued justify the cost. </p><h2 id="InfrastructureasCodePlatformforAzure-Actionitems">Action items</h2><p></p><ul class="inline-task-list" data-inline-tasks-content-id="8978442"><li class="checked" data-inline-task-id="1"><span class="placeholder-inline-tasks">Pulumi demonstration to VMIA</span></li><li class="checked" data-inline-task-id="2"><span class="placeholder-inline-tasks">Present decision findings and information to VMIA</span></li><li class="checked" data-inline-task-id="3"><span class="placeholder-inline-tasks">VMIA to make final decision on Infrastructure as Code Platform</span></li><li data-inline-task-id="4"><span class="placeholder-inline-tasks">VMIA to commence commercial conversations with Pulumi</span></li></ul><h2 id="InfrastructureasCodePlatformforAzure-Outcome">Outcome</h2><p>VMIA has agreed for Pulumi to be the Infrastructure as Code platform for the strategic data platform pending the outcome of commercial negotiations between Pulumi and VMIA. 3 Licenses will be provisioned. </p><p />
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/8978442/11599875.png">image-20200611-020835.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/8978442/11468805.png">image-20200611-021034.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Dec 15, 2021 03:10</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
